<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Manage | Movie Reviewer</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #0f0f0f;
            color: #e8e8e8;
            font-family: "Segoe UI", sans-serif;
        }
        /* Sidebar */
        .sidebar {
            height: 100vh;
            background-color: #1a1a1a;
            padding-top: 25px;
            border-right: 1px solid #303030;
        }
        .sidebar h4 { color: #fff; font-weight: 600; }
        .sidebar a {
            color: #bdbdbd;
            display: block;
            padding: 14px 22px;
            margin: 4px 12px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 15px;
            transition: 0.2s;
        }
        .sidebar a:hover, .sidebar a.active { background-color: #2b2b2b; color: #ffffff; }

        /* Table & Form */
        .card { background-color: #1a1a1a; border: 1px solid #2f2f2f; border-radius: 12px; }
        .poster-img { width: 60px; height: auto; border-radius: 5px; }
        .btn-custom { margin-right: 5px; }
        .form-section { background: #1a1a1a; padding: 20px; margin-bottom: 20px; border-radius: 12px; }

        /* Custom poster dropdown */
        .poster-dropdown {
            border: 1px solid #444;
            border-radius: 6px;
            background: #1a1a1a;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            position: absolute;
            width: 100%;
            z-index: 1000;
        }
        .poster-dropdown div {
            display: flex;
            align-items: center;
            padding: 5px 8px;
            cursor: pointer;
        }
        .poster-dropdown div:hover {
            background: #272727;
        }
        .poster-dropdown img {
            width: 40px;
            height: auto;
            margin-right: 10px;
            border-radius: 4px;
        }

        .poster-select {
            position: relative;
        }
        .poster-select input {
            cursor: pointer;
        }

        @media (max-width: 768px) { .sidebar { height: auto; } }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">

        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 sidebar">
            <h4 class="text-center mb-4">Admin Panel</h4>
            <a href="admin-dashboard.html">Dashboard</a>
            <a href="admin-add.html">Add Movie/Series</a>
            <a href="#" class="active">Manage List</a>
            <a href="#">Reviews</a>
            <a href="#">Users</a>
            <a href="#" class="text-danger mt-4 fw-bold">Logout</a>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10 p-4">
            <h2 class="fw-bold mb-4">Manage Movies/Series</h2>

            <!-- Form Section -->
            <div id="form-section" class="form-section" style="display:none;">
                <h4 id="form-title">Add Movie/Series</h4>
                <form id="movieForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title:</label>
                        <input type="text" id="title" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="type" class="form-label">Type:</label>
                        <select id="type" class="form-select" required>
                            <option value="">Select Type</option>
                            <option value="movie">Movie</option>
                            <option value="series">Series</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="year" class="form-label">Year:</label>
                        <input type="number" id="year" class="form-control" required>
                    </div>
                    <div class="mb-3 poster-select">
                        <label class="form-label">Poster:</label>
                        <input type="text" id="posterInput" class="form-control" placeholder="Select Poster" readonly required>
                        <div id="posterDropdown" class="poster-dropdown"></div>
                    </div>
                    <input type="hidden" id="editIndex">
                    <button type="submit" class="btn btn-success btn-custom">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="hideForm()">Cancel</button>
                </form>
            </div>

            <button class="btn btn-primary mb-3" onclick="showAddForm()">+ Add Movie/Series</button>

            <!-- Table Section -->
            <div class="card p-3">
                <table class="table table-dark table-striped mb-0" id="movieTable">
                    <thead>
                        <tr>
                            <th>Poster</th>
                            <th>Title</th>
                            <th>Type</th>
                            <th>Year</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Movie rows dynamically added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    let movies = JSON.parse(localStorage.getItem("movies")) || [];
    let posters = JSON.parse(localStorage.getItem("posters")) || [];

    const movieTable = document.querySelector("#movieTable tbody");
    const posterInput = document.getElementById("posterInput");
    const posterDropdown = document.getElementById("posterDropdown");

    function renderPosterDropdown() {
        posterDropdown.innerHTML = '';
        posters.forEach((p, index) => {
            const div = document.createElement("div");
            div.innerHTML = `<img src="${p}" alt="Poster"> Poster ${index+1}`;
            div.addEventListener("click", () => {
                posterInput.value = p;
                posterDropdown.style.display = "none";
            });
            posterDropdown.appendChild(div);
        });
    }

    posterInput.addEventListener("click", () => {
        posterDropdown.style.display = posterDropdown.style.display === "block" ? "none" : "block";
    });

    document.addEventListener("click", (e) => {
        if (!e.target.closest(".poster-select")) {
            posterDropdown.style.display = "none";
        }
    });

    function renderTable() {
        movieTable.innerHTML = '';
        movies.forEach((movie, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td><img src="${movie.poster}" class="poster-img" alt="Poster"></td>
                <td>${movie.title}</td>
                <td>${movie.type}</td>
                <td>${movie.year}</td>
                <td>
                    <button class="btn btn-warning btn-sm btn-custom" onclick="editMovie(${index})">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteMovie(${index})">Delete</button>
                </td>
            `;
            movieTable.appendChild(row);
        });
    }

    function showAddForm() {
        document.getElementById('form-section').style.display = 'block';
        document.getElementById('form-title').textContent = 'Add Movie/Series';
        document.getElementById('movieForm').reset();
        document.getElementById('editIndex').value = '';
        renderPosterDropdown();
    }

    function hideForm() {
        document.getElementById('form-section').style.display = 'none';
    }

    document.getElementById("movieForm").addEventListener("submit", function(e){
        e.preventDefault();
        const movie = {
            title: document.getElementById("title").value,
            type: document.getElementById("type").value,
            year: document.getElementById("year").value,
            poster: posterInput.value
        };
        const editIndex = document.getElementById("editIndex").value;
        if(editIndex === '') {
            movies.push(movie);
        } else {
            movies[editIndex] = movie;
        }
        localStorage.setItem("movies", JSON.stringify(movies));
        hideForm();
        renderTable();
    });

    function editMovie(index) {
        const movie = movies[index];
        document.getElementById("title").value = movie.title;
        document.getElementById("type").value = movie.type;
        document.getElementById("year").value = movie.year;
        renderPosterDropdown();
        posterInput.value = movie.poster;
        document.getElementById("editIndex").value = index;
        document.getElementById('form-title').textContent = 'Edit Movie/Series';
        document.getElementById('form-section').style.display = 'block';
    }

    function deleteMovie(index) {
        if(confirm('Are you sure you want to delete this movie/series?')) {
            movies.splice(index, 1);
            localStorage.setItem("movies", JSON.stringify(movies));
            renderTable();
        }
    }

    // Initial render
    renderPosterDropdown();
    renderTable();
</script>

</body>
</html>